{% extends "base.html" %}

{% block content %}
<div class="card center gen-card">
  <div class="pencil-wrapper">
    <div class="pencil"></div>
    <div class="line"></div>
  </div>

  <h3 id="msg" class="gen-msg">
    ğ”Šğ”¢ğ”«ğ”¢ğ”¯ğ”ğ”±ğ”¦ğ”«ğ”¤ ğ”¶ğ”¬ğ”²ğ”¯ ğ”«ğ”¬ğ”±ğ”¢ğ”°â€¦ ğ”­ğ”©ğ”¢ğ”ğ”°ğ”¢ ğ”´ğ”ğ”¦ğ”±
  </h3>
</div>
{% endblock %}

{% block scripts %}
<script>
async function poll() {
  const res  = await fetch("/api/status/{{ task_id }}");
  const data = await res.json();

  if (data.state === "SUCCESS") {
    document.querySelector(".pencil-wrapper").style.display = "none";
    document.getElementById("msg").innerHTML =
      `<a class="dl-btn" href="/download/{{ task_id }}" download>â¬‡ Download PDF</a>`;
  } else if (data.state === "FAILURE") {
    document.querySelector(".pencil-wrapper").style.display = "none";
    document.getElementById("msg").textContent =
      "Failed: " + (data.result?.error || "unknown error");
  } else {
    setTimeout(poll, 2500);
  }
}
poll();
</script>
{% endblock %}
