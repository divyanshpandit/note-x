{% extends "base.html" %}

{% block content %}
<div class="card center" style="text-align:center;">
  <!-- Spinner (visible at first) -->
  <div id="spinner" class="orbit-loader">
  <div></div><div></div><div></div><div></div>
</div>


  <!-- Message placeholder -->
  <h2 id="msg" style="margin-top:1.2rem;">Generating…</h2>
</div>
{% endblock %}

{% block scripts %}
<script>
async function poll() {
  const res  = await fetch("/api/status/{{ task_id }}");
  const data = await res.json();

  if (data.state === "SUCCESS") {
    document.getElementById("spinner").style.display = "none";
    document.getElementById("msg").innerHTML =
      `<a class="dl-btn" href="/download/{{ task_id }}" download>⬇ Download PDF</a>`;
  } else if (data.state === "FAILURE") {
    document.getElementById("spinner").style.display = "none";
    document.getElementById("msg").textContent =
      "Failed: " + (data.error ?? "unknown error");
  } else {
    setTimeout(poll, 3000);
  }
}
poll();
</script>
{% endblock %}
